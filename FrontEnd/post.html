<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="./js/index.js"></script>
    <style>
        tr{
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>게시판</h1>
    <a id="toInsert">글 등록하기</a>
    <table id="post_list">
        
    </table>
    <div id="btns">        
    </div>
</body>
<script>
    async function GetAPI(currentPage){
        try {
            post_list.innerHTML = "";
            let _tr1 = document.createElement('tr');
            let _th1 = document.createElement('th');
            let _th2 = document.createElement('th');
            let _th3 = document.createElement('th');
            let _th4 = document.createElement('th');
            let _th5 = document.createElement('th');
            let _th6 = document.createElement('th');
            _th1.innerHTML = "No.";
            _th2.innerHTML = '제목';
            _th3.innerHTML = '작성자';
            _th4.innerHTML = '작성일';
            _th5.innerHTML = '수정일';
            _th6.innerHTML = '조회수';
            _tr1.append(_th1,_th2,_th3,_th4,_th5,_th6);
            post_list.append(_tr1);

            btns.innerHTML = '';
            
            const {data} = await API.get('/post',{
                headers : {
                    'Content-Type' : "application/json"
                }
            });

            let pageOffset = 10;
            let pageGroup = currentPage * pageOffset;
            let pageNum = 0;

            if(data == null){
                return;
            }else{
                data.forEach((el,index)=>{
                    if(index % pageOffset == 0){
                        let btn = document.createElement('button');
                        btn.innerHTML = index / 10 + 1;
                        btn.className = 'pageBtn';
                        btn.onclick = ()=>{
                            pageNum = index;
                            GetAPI(index / pageOffset);
                        }
                        btns.append(btn);
                    }
                })
                
                const _data = data.slice(pageGroup,pageGroup + pageOffset);

                _data.forEach((el,index) => {
                    let date = new Date();
                    let year = date.getFullYear();
                    let month = date.getMonth() + 1;
                    let day = date.getDate();
                    let nowdate = year.toString();
                    
                    if(month >= 10){
                        nowdate += month;
                    }else{
                        nowdate += '0' + month;
                    }

                    if(day >= 10){
                        nowdate += day;
                    }else{
                        nowdate += '0' + day;
                    }

                    nowdate = Number(nowdate);

                    let createDate = Number(el.createdAt.slice(0,10).split('-').join(''));
                    let updateDate = Number(el.updatedAt.slice(0,10).split('-').join(''));

                    let _tr = document.createElement('tr');
                    let _td1 = document.createElement('td');
                    let _td2 = document.createElement('td');
                    let _td3 = document.createElement('td');
                    let _td4 = document.createElement('td');
                    let _td5 = document.createElement('td');
                    let _td6 = document.createElement('td');
                    _td1.innerHTML = index + 1;
                    _td2.innerHTML = el.title;
                    _td3.innerHTML = el.User.nickname;

                    if(nowdate > createDate){
                        _td4.innerHTML = el.createdAt.slice(0,10);
                    }else{
                        _td4.innerHTML = el.createdAt.slice(11,19);
                    }

                    if(nowdate > updateDate){
                        _td5.innerHTML = el.updatedAt.slice(0,10);
                    }else{
                        _td5.innerHTML = el.updatedAt.slice(11,19);
                    }

                    _td6.innerHTML = el.postViews;

                    _tr.onclick = async()=>{
                        await API.post('./post/detail',{
                            headers : {
                                'Content-Type' : "application/json"
                            },
                            data : el.id
                        }).then((e)=>{
                            location.href = e.data;
                        }).catch((err)=>{
                            console.log(err);
                        })
                    }

                    _tr.append(_td1,_td2,_td3,_td4,_td5,_td6);
                    post_list.append(_tr);
                });
            }
        } catch (error) {
            console.log(error);
        }
    }

    GetAPI(0);

    toInsert.onclick = ()=>{
        location.href = `./insert${urlEnd}`;
    }
</script>
</html>